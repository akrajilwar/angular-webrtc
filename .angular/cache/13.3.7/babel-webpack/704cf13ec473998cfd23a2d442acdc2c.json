{"ast":null,"code":"import _asyncToGenerator from \"/Users/amtagglobal/Desktop/Projects/angular-webrtc/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { v4 as uuidv4 } from 'uuid';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"ngx-socket-io\";\nimport * as i2 from \"src/app/services/signaling.service\";\nexport class HostComponent {\n  constructor(socket, signalingService) {\n    this.socket = socket;\n    this.signalingService = signalingService;\n    this.currentUserId = uuidv4();\n    this.makingOffer = false;\n    this.servers = {\n      iceServers: [{\n        urls: ['stun:stun1.l.google.com:19302', 'stun:stun2.l.google.com:19302']\n      }],\n      iceCandidatePoolSize: 10\n    };\n    this.pc = new RTCPeerConnection(this.servers);\n  }\n\n  ngOnInit() {\n    console.log(`Initialize Peer with id ${this.currentUserId}`);\n    this.createStream();\n  }\n\n  createStream() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      _this.localStream = yield navigator.mediaDevices.getUserMedia({\n        audio: true,\n        video: true\n      });\n\n      _this.localStream.getTracks().forEach(track => {\n        _this.pc.addTrack(track, _this.localStream);\n      });\n\n      let messages = _this.signalingService.getMessages();\n\n      _this.pc.onnegotiationneeded = /*#__PURE__*/_asyncToGenerator(function* () {\n        try {\n          _this.makingOffer = true;\n          yield _this.pc.setLocalDescription();\n\n          _this.signalingService.sendEvent('offer', {\n            description: _this.pc.localDescription\n          });\n        } catch (err) {\n          console.error(err);\n        } finally {\n          _this.makingOffer = false;\n        }\n      });\n    })();\n  }\n\n  onLoadedMetadata(event) {\n    event.target.play();\n  }\n\n}\n\nHostComponent.ɵfac = function HostComponent_Factory(t) {\n  return new (t || HostComponent)(i0.ɵɵdirectiveInject(i1.Socket), i0.ɵɵdirectiveInject(i2.SignalingService));\n};\n\nHostComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: HostComponent,\n  selectors: [[\"app-host\"]],\n  decls: 1,\n  vars: 1,\n  consts: [[\"autoplay\", \"\", \"playsinline\", \"\", \"muted\", \"\", 3, \"srcObject\"]],\n  template: function HostComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelement(0, \"video\", 0);\n    }\n\n    if (rf & 2) {\n      i0.ɵɵproperty(\"srcObject\", ctx.localStream);\n    }\n  },\n  styles: [\"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJob3N0LmNvbXBvbmVudC5zY3NzIn0= */\"]\n});","map":{"version":3,"sources":["/Users/amtagglobal/Desktop/Projects/angular-webrtc/src/app/pages/host/host.component.ts"],"names":["v4","uuidv4","i0","i1","i2","HostComponent","constructor","socket","signalingService","currentUserId","makingOffer","servers","iceServers","urls","iceCandidatePoolSize","pc","RTCPeerConnection","ngOnInit","console","log","createStream","localStream","navigator","mediaDevices","getUserMedia","audio","video","getTracks","forEach","track","addTrack","messages","getMessages","onnegotiationneeded","setLocalDescription","sendEvent","description","localDescription","err","error","onLoadedMetadata","event","target","play","ɵfac","HostComponent_Factory","t","ɵɵdirectiveInject","Socket","SignalingService","ɵcmp","ɵɵdefineComponent","type","selectors","decls","vars","consts","template","HostComponent_Template","rf","ctx","ɵɵelement","ɵɵproperty","styles"],"mappings":"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","sourcesContent":["import { v4 as uuidv4 } from 'uuid';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"ngx-socket-io\";\nimport * as i2 from \"src/app/services/signaling.service\";\nexport class HostComponent {\n    constructor(socket, signalingService) {\n        this.socket = socket;\n        this.signalingService = signalingService;\n        this.currentUserId = uuidv4();\n        this.makingOffer = false;\n        this.servers = {\n            iceServers: [\n                {\n                    urls: ['stun:stun1.l.google.com:19302', 'stun:stun2.l.google.com:19302'],\n                },\n            ],\n            iceCandidatePoolSize: 10,\n        };\n        this.pc = new RTCPeerConnection(this.servers);\n    }\n    ngOnInit() {\n        console.log(`Initialize Peer with id ${this.currentUserId}`);\n        this.createStream();\n    }\n    async createStream() {\n        this.localStream = await navigator.mediaDevices.getUserMedia({ audio: true, video: true, });\n        this.localStream.getTracks().forEach((track) => {\n            this.pc.addTrack(track, this.localStream);\n        });\n        let messages = this.signalingService.getMessages();\n        this.pc.onnegotiationneeded = async () => {\n            try {\n                this.makingOffer = true;\n                await this.pc.setLocalDescription();\n                this.signalingService.sendEvent('offer', { description: this.pc.localDescription });\n            }\n            catch (err) {\n                console.error(err);\n            }\n            finally {\n                this.makingOffer = false;\n            }\n        };\n    }\n    onLoadedMetadata(event) {\n        event.target.play();\n    }\n}\nHostComponent.ɵfac = function HostComponent_Factory(t) { return new (t || HostComponent)(i0.ɵɵdirectiveInject(i1.Socket), i0.ɵɵdirectiveInject(i2.SignalingService)); };\nHostComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: HostComponent, selectors: [[\"app-host\"]], decls: 1, vars: 1, consts: [[\"autoplay\", \"\", \"playsinline\", \"\", \"muted\", \"\", 3, \"srcObject\"]], template: function HostComponent_Template(rf, ctx) { if (rf & 1) {\n        i0.ɵɵelement(0, \"video\", 0);\n    } if (rf & 2) {\n        i0.ɵɵproperty(\"srcObject\", ctx.localStream);\n    } }, styles: [\"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJob3N0LmNvbXBvbmVudC5zY3NzIn0= */\"] });\n"]},"metadata":{},"sourceType":"module"}